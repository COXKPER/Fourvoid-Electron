<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Fourvoid</title>

<meta http-equiv="Content-Security-Policy"
      content="default-src 'self';
               script-src 'self' 'unsafe-inline';
               style-src 'self' 'unsafe-inline';
               frame-src https:;
               connect-src https:;">

<style>
:root{
  --bg:#121212;
  --hover:rgba(255,255,255,0.08);
  --danger:#e81123;
  --text:#ffffff;
}

*{
  box-sizing:border-box;
  font-family:system-ui,-apple-system,sans-serif;
}

html,body{
  height:100%;
  margin:0;
  background:#0f0f0f;
  overflow:hidden;
  display:flex;
  flex-direction:column;
}

/* ===== TITLEBAR ===== */
.titlebar{
  height:42px;
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding-left:12px;
  padding-right:0;
  background:var(--bg);
  color:var(--text);
  border-bottom:1px solid rgba(255,255,255,0.08);
  user-select:none;
  -webkit-app-region:drag;
}

.title{
  font-size:14px;
  font-weight:500;
  opacity:.9;
}

.controls{
  display:flex;
  height:100%;
}

.controls button{
  -webkit-app-region:no-drag;
  width:46px;
  height:100%;
  border:none;
  background:transparent;
  color:#fff;
  cursor:pointer;
  font-size:14px;
  transition:.15s;
}

.controls button:hover{
  background:var(--hover);
}

.controls button.close:hover{
  background:var(--danger);
}

/* ===== CONTENT ===== */
#content{
  flex:1;
  position:relative;
  display:flex;
}

/* ===== WEBVIEW ===== */
#wv{
  flex:1;
  width:100%;
}

/* ===== LOADING ===== */
#loading{
  position:absolute;
  inset:0;
  display:flex;
  align-items:center;
  justify-content:center;
  background:#0f0f0f;
  color:white;
  font-size:14px;
  z-index:10;
}

/* ===== ERROR ===== */
#error{
  position:absolute;
  inset:0;
  display:none;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  background:#0f0f0f;
  color:white;
  text-align:center;
  padding:20px;
  z-index:20;
}

#error button{
  margin-top:15px;
  padding:8px 16px;
  border:none;
  border-radius:6px;
  background:#2b2b2b;
  color:white;
  cursor:pointer;
}

#error button:hover{
  background:#3a3a3a;
}
.titlebar button{
  cursor: default;
}
</style>
</head>

<body>

<div class="titlebar">
  <div class="title">Fourvoid</div>
  <div class="controls">
    <button id="reload">⟳</button>
    <button onclick="window.api.minimize()">─</button>
    <button id="maxbtn" onclick="window.api.maximize()">☐</button>
    <button class="close" onclick="window.api.close()">✕</button>
  </div>
</div>

<div id="content">

  <div id="loading">Loading</div>

  <div id="error">
    <h2>⚠ Failed to load application</h2>
    <p>Connectivity Problem or Blocked by Your ISP.</p>
    <button id="retry">Retry</button>
  </div>

  <webview
    id="wv"
    src="https://fourvo.id"
    preload="preload.js" allowpopups>
  </webview>

</div>

<script>
const webview = document.getElementById("wv");
const loading = document.getElementById("loading");
const errorScreen = document.getElementById("error");
const reloadBtn = document.getElementById("reload");
const retryBtn = document.getElementById("retry");
const maxBtn = document.getElementById("maxbtn");

/* ===== LOADING STATE ===== */
webview.addEventListener("did-start-loading", () => {
  loading.style.display = "flex";
  errorScreen.style.display = "none";
});

webview.addEventListener("did-stop-loading", () => {
  loading.style.display = "none";
});

/* ===== ERROR HANDLER ===== */
webview.addEventListener("did-fail-load", () => {
  loading.style.display = "none";
  errorScreen.style.display = "flex";
});

/* ===== RELOAD ===== */
reloadBtn.addEventListener("click", () => webview.reload());
retryBtn.addEventListener("click", () => {
  errorScreen.style.display = "none";
  webview.reload();
});

/* ===== MAXIMIZE ICON TOGGLE ===== */
if(window.api?.onMaximizeChange){
  window.api.onMaximizeChange((isMax)=>{
    maxBtn.textContent = isMax ? "❐" : "☐";
  });
}

webview.addEventListener("did-attach", () => {
  webview.setWindowOpenHandler(({ url }) => {
    if (!isAllowed(url)) {
      window.api.openExternal(url);
      return { action: 'deny' };
    }
    return { action: 'allow' };
  });
});
</script>

</body>
</html>